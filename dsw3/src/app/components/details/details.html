<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold text-primary" routerLink="/home">
      StockApp
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#" (click)="$event.preventDefault(); logout()">
            <i class="bi bi-box-arrow-right"></i> Logout
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<div class="container mt-4 mb-4">
  <h1 class="mb-4">Detalhes da ação: {{ ticker }}</h1>

  @if (loading) {
    <div class="text-center mt-4">
      <div class="spinner-border text-primary" role="status"></div>
      <p>Carregando dados…</p>
    </div>
  } @else if (chartData?.datasets?.length) {
    <div>
      <canvas
        baseChart
        [data]="chartData"
        [options]="chartOptions"
        [type]="chartType">
      </canvas>

      <hr class="my-4">

      <div class="row text-center">
        <div class="col-md-3 mb-3">
          <h6 class="text-muted">Último fechamento</h6>
          <p class="fw-bold">${{ lastClose?.toFixed(2) }}</p>
        </div>
        <div class="col-md-3 mb-3">
          <h6 class="text-muted">Menor preço</h6>
          <p class="fw-bold text-danger">${{ minPrice?.toFixed(2) }}</p>
        </div>
        <div class="col-md-3 mb-3">
          <h6 class="text-muted">Maior preço</h6>
          <p class="fw-bold text-success">${{ maxPrice?.toFixed(2) }}</p>
        </div>
        <div class="col-md-3 mb-3">
          <h6 class="text-muted">Variação 30 dias</h6>
          <p class="fw-bold"
             [ngClass]="variation! >= 0 ? 'text-success' : 'text-danger'">
            {{ variation! >= 0 ? '+' : '' }}{{ variation?.toFixed(2) }}%
          </p>
        </div>
      </div>

      <hr class="my-4">

      <!-- Seção de Predições -->
      <div class="text-center">
        <button class="btn btn-primary px-4" (click)="togglePredictions()">
          {{ showPredictions ? 'Ocultar' : 'Ver' }} Previsões de Preço
        </button>
      </div>

      @if(showPredictions) {
        <app-prediction-card [ticker]="ticker!"></app-prediction-card>
      }

      <hr class="my-4">
      <div class="text-center mt-4">
        <a routerLink="/home" class="btn btn-outline-secondary px-4">
          ← Voltar
        </a>
      </div>
    </div>
  } @else {
    <p>Sem dados disponíveis.</p>
    <div class="text-center mt-4">
      <a routerLink="/home" class="btn btn-outline-secondary px-4">
        ← Voltar
      </a>
    </div>
  }
</div>